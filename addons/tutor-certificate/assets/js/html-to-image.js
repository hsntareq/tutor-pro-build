jQuery(document).ready(function(d){var t=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./),s=t?parseInt(t[1]):0,u=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),p=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),e=wp.i18n,g=e.__;e._x,e._n,e._nx;d("body").append('<svg id="tutor_svg_font_id" width="0" height="0" style="background-color:white;"></svg>');function f(t,r){var e=new XMLHttpRequest;e.open("get","?tutor_action=get_fonts&course_id="+t),e.responseType="text",e.send(),e.onloadend=function(){var o=e.response,i=o.match(/https?:\/\/[^ \)]+/g),a=0;i.forEach(function(e){var n=new XMLHttpRequest;n.open("get",e),n.responseType="blob",n.onloadend=function(){var t=new FileReader;t.onloadend=function(){o=o.replace(new RegExp(e),t.result),++a==i.length&&(d("#tutor_svg_font_id").prepend("<style>".concat(o,"</style>")),r())},t.readAsDataURL(n.response)},n.send()})}}var h=function(t){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.naturalWidth,e.height=t.naturalHeight,n.drawImage(t,0,0),e.toDataURL("image/png")},n=d("#tutor-download-certificate-pdf"),o=d("#tutor-pro-certificate-download-pdf"),t=0<n.length?n:o,a=d('<img class="tutor_progress_spinner" style="display:inline;margin-left:5px" src="'+window._tutorobject.loading_icon_url+'"/>'),e=d("#tutor-view-certificate-image"),r=new function(r,c,e){var l=this;this.view=function(t){window.location.assign(e)},this.download=function(t,e,n){var o=new window.jsPDF(n<e?"l":"p","px",[e,n]);o.addImage(t,"jpeg",0,0,e-.249*e,n-.249*n),o.save("certificate-"+(new Date).getTime()+".pdf")},this.reload=function(){window.location.reload()},this.dataURItoBlob=function(t,e){for(var n=atob(t.split(",")[1]),t=new ArrayBuffer(n.length),o=new Uint8Array(t),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);return new Blob([t],{type:e})},this.store_certificate=function(t,n){var e=tutor_get_nonce_data(!0),o=new FormData;o.append("action","tutor_store_certificate_image"),o.append("cert_hash",c),o.append("certificate_image",l.dataURItoBlob(t,"image/jpeg"),"certificate.jpg"),o.append(e.key,e.value),d.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:o,processData:!1,contentType:!1,success:function(t){var e=(t.data||{}).message;n(t&&t.success,e)},error:function(){n(!1)}})},this.dispatch_conversion_methods=function(i,t,a){var e=t.getElementsByTagName("body")[0],n=t.getElementById("watermark"),o=n.offsetWidth,n=n.offsetHeight;e.style.display="inline-block",e.style.overflow="hidden",e.style.width=o+"px",e.style.height=n+"px",e.style.padding="0px",e.style.margin="0px";var r,c,d,s=t.getElementsByTagName("body")[0],u={scale:3,letterRendering:!0,logging:!0,foreignObjectRendering:p,allowTaint:!0,useCORS:!0,x:0,y:0,width:o,height:n,windowWidth:o,windowHeight:n};r=function(){html2canvas(s,u).then(function(n){var o=n.toDataURL("image/jpeg",1);l.store_certificate(o,function(t,e){t||alert(e||g("Something Went Wrong","tutor-pro")),t&&"function"==typeof l[i]&&l[i](o,n.width,n.height),"function"==typeof a&&a(t)})})},c=t.getElementsByTagName("img"),d=0,function t(){d>=c.length?r():(c[d].onload=t,c[d].src=h(c[d]),d+=1)}()},this.init_render_certificate=function(i,a){d.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:{action:"tutor_generate_course_certificate",course_id:r,certificate_hash:c||""},success:function(t){function e(t){var e;t.write(n),t.write(d("<div></div>").append(d("#tutor_svg_font_id").clone()).html()),s&&((e=window.document.createElement("style")).innerHTML="*{word-spacing:3px !important; letter-spacing:2px !important;}",t.getElementsByTagName("head")[0].appendChild(e))}var n=t.success?t.data.html:"",o=document.createElement("iframe");s||u?o.addEventListener("load",function(){var t=(t=o.contentWindow||o.contentDocument.document||o.contentDocument).document;e(t),f(r,function(){return l.dispatch_conversion_methods(i,t,a)})}):f(r,function(){var t=o.contentWindow||o.contentDocument.document||o.contentDocument;(t=t.document).open(),e(t),t.close(),o.onload=function(){return l.dispatch_conversion_methods(i,t,a)}}),o.style.position="absolute",o.style.left="-999999px",document.getElementsByTagName("body")[0].appendChild(o)}})}}(t.data("course_id"),t.data("cert_hash"),e.data("href"));n.add(e).add(o).click(function(t){var e,n,o,i=this;t.preventDefault(),d(this).hasClass("tutor-cert-view-page")?(0==d(this).find(".tutor_progress_spinner").length&&d(this).append(a),o="tutor-view-certificate-image"==d(this).attr("id")?"view":"download",r.init_render_certificate(o,function(){d(i).find(".tutor_progress_spinner").remove()})):((e=document.getElementById("tutor-download-certificate-pdf")).classList.add("active"),n=e.innerHTML,e.innerHTML=window.tutorDotLoader(),o="tutor-view-certificate-image"==d(this).attr("id")?"view":"download",r.init_render_certificate(o,function(){e.innerHTML=n,e.classList.remove("active")}))});o=d("#tutor-pro-certificate-download-image");o.click(function(){var t=d("#tutor-pro-certificate-preview"),e=document.createElement("A");e.href=t.attr("src"),e.download="certificate-"+(new Date).getTime()+".jpg",document.body.appendChild(e),e.click(),document.body.removeChild(e)}),0<o.length&&"no"==d("#tutor-pro-certificate-preview").data("is_generated")&&r.init_render_certificate("",function(){window.location.reload()})});